<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coast Connect — Home</title>
  <link rel="icon" href="images/coast_logo.png" />

  <!-- Tailwind (cdn) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />

  <!-- Swiper -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

  <!-- SEO & Social -->
  <meta name="description" content="Coast Connect — connecting coastal businesses and people along Kenya's coast" />
  <meta property="og:title" content="Coast Connect — Home" />
  <meta property="og:description" content="Discover and list businesses across Kenya's coast. Fast, local, trusted." />
  <meta property="og:image" content="images/og-card.jpg" />
  <meta property="og:type" content="website" />

  <style>
    /* ---------- Global ---------- */
    html, body { height: 100%; }
    .smooth-shadow { box-shadow: 0 10px 40px rgba(2,6,23,.08); }
    .micro { transition: all .28s cubic-bezier(.2,.9,.2,1); }
    .micro:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 18px 42px rgba(2,6,23,.12); }

    /* ---------- Loading Screen ---------- */
    #loader {
      position: fixed; inset: 0; display: grid; place-items: center; background: #0b1020; z-index: 9999;
      background-image: radial-gradient(1200px 600px at 50% -10%, rgba(88,81,219,.22), transparent),
                        radial-gradient(800px 600px at 10% 110%, rgba(245,158,11,.18), transparent),
                        radial-gradient(800px 600px at 100% 110%, rgba(16,185,129,.16), transparent);
    }
    #loader .logo { width: 90px; height: 90px; border-radius: 20px; filter: drop-shadow(0 10px 30px rgba(0,0,0,.35)); }
    .ring { width: 120px; height: 120px; border: 3px solid rgba(255,255,255,.12); border-top-color: #facc15; border-radius: 9999px; animation: spin 1.2s linear infinite; position: absolute; }
    @keyframes spin { to { transform: rotate(360deg);} }

    /* ---------- Glass ---------- */
    .glass { background: linear-gradient(135deg, rgba(255,255,255,0.65), rgba(255,255,255,0.22)); backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%); border: 1px solid rgba(255,255,255,0.16); }
    .glass-dark { background: linear-gradient(135deg, rgba(17,24,39,0.6), rgba(17,24,39,0.18)); border: 1px solid rgba(255,255,255,0.04); }

    /* ---------- Hero ---------- */
    .hero-bg { background-image: url('images/hero_sunset.jpg'); background-size: cover; background-position: center; }

    /* ---------- Ribbons ---------- */
    .ribbon { position: absolute; top: .75rem; left: -.25rem; padding: .25rem .6rem; color: #111827; font-weight: 800; font-size: .7rem; border-radius: .375rem; }
    .ribbon-gold { background: linear-gradient(135deg,#facc15,#f59e0b); color:#111827; box-shadow: 0 8px 20px rgba(245,158,11,.35); }
    .ribbon-silver { background: linear-gradient(135deg,#e5e7eb,#9ca3af); color:#111827; }
    .ribbon-bronze { background: linear-gradient(135deg,#f59e0b,#b45309); color:#111827; }

    /* ---------- Shimmer ---------- */
    .skeleton { position: relative; overflow: hidden; background: rgba(0,0,0,.06); }
    .skeleton::after { content: ""; position: absolute; inset: 0; transform: translateX(-100%); background: linear-gradient(90deg, transparent, rgba(255,255,255,.38), transparent); animation: shimmer 1.2s infinite; }
    @keyframes shimmer { 100% { transform: translateX(100%);} }

    /* ---------- Gold shine for featured ---------- */
    .gold-frame { position: relative; border-radius: 1rem; padding: 2px; background: linear-gradient(135deg,rgba(250,204,21,.8),rgba(245,158,11,.3)); }
    .gold-frame::before { content:""; position:absolute; inset:-2px; background: conic-gradient(from 0deg, #fde68a, #f59e0b, #fde68a); filter: blur(14px); opacity:.35; border-radius: 1.1rem; }

    /* ---------- Equal heights helper ---------- */
    .equal-grid { align-items: stretch; }

    /* ---------- Marquee ---------- */
    .marquee { white-space: nowrap; }

    /* ---------- Sticky section headers ---------- */
    .sticky-title { position: sticky; top: 0; z-index: 5; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }
  </style>
</head>

<body class="bg-gray-50 text-gray-900 selection:bg-indigo-300 selection:text-white dark:bg-gray-900 dark:text-gray-100">
  <!-- ===== Loader ===== -->
  <div id="loader">
    <div class="relative grid place-items-center gap-5">
      <div class="ring"></div>
      <img src="images/coast_logo.png" alt="Coast Connect" class="logo" />
      <div class="text-center">
        <p class="text-white/90 font-semibold tracking-wide">Coast Connect</p>
        <p class="text-white/60 text-xs">Loading opportunities…</p>
      </div>
    </div>
  </div>

  <!-- ========== Header ========== -->
  <header class="sticky top-0 z-50">
    <nav class="backdrop-blur-md glass dark:glass-dark container mx-auto px-6 py-3 rounded-b-2xl flex items-center justify-between gap-4 mt-2">
      <div class="flex items-center gap-3">
        <a href="index.html" class="flex items-center gap-3">
          <img src="images/coast_logo.png" alt="Coast Connect" class="w-10 h-10 rounded" />
          <div>
            <span class="font-extrabold text-lg text-indigo-600 dark:text-indigo-400">Coast Connect</span>
            <div class="text-xs -mt-1 text-gray-500 dark:text-gray-300">Connect · Serve · Uplift</div>
          </div>
        </a>
      </div>

      <div class="hidden md:flex items-center gap-8">
        <ul class="flex gap-6 items-center text-sm font-medium">
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="index.html">Home</a></li>
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="listings.html">Listings</a></li>
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="categories.html">Categories</a></li>
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="about.html">About</a></li>
        </ul>
        <div class="flex items-center gap-3">
          <button id="dark-toggle" aria-label="Toggle dark mode" class="p-2 rounded-full micro bg-white dark:bg-gray-800/60">
            <svg id="dark-icon" class="w-5 h-5 text-indigo-600 dark:text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-10h-1M4.34 12h-1M18.36 6.36l-.7.7M6.34 18.36l-.7.7M18.36 17.64l-.7-.7M6.34 5.64l-.7-.7M12 6a6 6 0 000 12 6 6 0 000-12z"/></svg>
          </button>
          <a href="listings.html" class="inline-flex items-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-black px-4 py-2 rounded-lg font-semibold shadow">🚀 List Your Service</a>
        </div>
      </div>

      <!-- Mobile -->
      <div class="md:hidden flex items-center gap-3">
        <button id="mobile-toggle" class="p-2 rounded-md glass micro" aria-label="Open menu">
          <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </nav>

    <!-- Mobile menu panel -->
    <div id="mobile-panel" class="hidden md:hidden container mx-auto px-6 mt-3">
      <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow micro">
        <ul class="space-y-2">
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="index.html">Home</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="listings.html">Listings</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="categories.html">Categories</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="about.html">About</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- ========== HERO (split) ========== -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 hero-bg brightness-75"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-white/10 mix-blend-multiply"></div>

    <div class="container mx-auto max-w-7xl relative z-20 py-20 px-6">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
        <!-- Left: Headline / Stats -->
        <div class="lg:col-span-7 text-center lg:text-left">
          <div class="max-w-2xl">
            <img src="images/coast_logo.png" alt="Coast Connect" class="w-20 h-20 mx-auto lg:mx-0 mb-4 drop-shadow-xl rounded-full" />
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white leading-tight" data-aos="fade-right">
              <span id="typewriter-text" class="inline-block"></span>
            </h1>
            <p class="mt-4 text-lg text-gray-200 max-w-xl" data-aos="fade-right" data-aos-delay="120">
              From Watamu to Lamu — discover businesses, services and community across the Coast. Fast, local, trusted.
            </p>

            <div class="mt-6 flex flex-col sm:flex-row gap-3 items-center" data-aos="fade-up" data-aos-delay="220">
              <a href="listings.html" class="inline-flex items-center gap-3 bg-yellow-400 hover:bg-yellow-500 text-black px-5 py-3 rounded-full font-semibold shadow-lg transform hover:scale-105 transition">List Your Service</a>
              <a href="#popular-categories" class="inline-flex items-center gap-2 border border-white/30 text-white px-4 py-3 rounded-full hover:bg-white/5 transition">Explore Categories</a>
            </div>

            <!-- Animated Counters -->
            <div class="mt-8 grid grid-cols-3 gap-4 max-w-md" data-aos="fade-up" data-aos-delay="320">
              <div class="bg-white/10 glass-dark rounded-xl py-4 px-4 text-center">
                <div class="text-2xl font-extrabold text-white" id="count-businesses">0</div>
                <div class="text-xs text-gray-200">Businesses Listed</div>
              </div>
              <div class="bg-white/10 glass-dark rounded-xl py-4 px-4 text-center">
                <div class="text-2xl font-extrabold text-white" id="count-regions">0</div>
                <div class="text-xs text-gray-200">Regions Covered</div>
              </div>
              <div class="bg-white/10 glass-dark rounded-xl py-4 px-4 text-center">
                <div class="text-2xl font-extrabold text-white" id="count-clients">0</div>
                <div class="text-xs text-gray-200">Happy Clients</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Rotating categories (hero quick categories) -->
        <aside class="lg:col-span-5">
            <div class="glass rounded-2xl p-4 sm:p-6 max-h-[520px] overflow-y-auto quick-cat" data-aos="fade-left">
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100">Trending Categories</h3>
                <button id="start-rotator" class="text-xs px-2 py-1 rounded bg-black/10 dark:bg-white/10">▶</button>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">They rotate here with smooth transitions — click any to filter below.</p>
              <div id="hero-rotator" class="space-y-3"></div>
              <div class="mt-6">
                <input id="quick-search" type="search" placeholder="Search categories or listings…" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500" />
              </div>
              <div class="mt-6 text-center">
                <a href="categories.html" class="text-sm text-indigo-600 font-semibold hover:underline">View all categories</a>
              </div>
            </div>
          </aside>
        </div>
      </div>

    <!-- Rotating category ticker -->
    <div class="absolute bottom-0 left-0 right-0">
      <div class="overflow-hidden">
        <div id="cat-marquee" class="flex gap-6 py-3 px-6 bg-black/30 backdrop-blur text-white whitespace-nowrap marquee"></div>
      </div>
    </div>
  </section>

  <!-- ===== Featured Gold Partners ===== -->
<section class="container mx-auto max-w-7xl px-6 py-12" data-aos="fade-up">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <span class="text-3xl">🏆</span>
        <h2 class="text-2xl font-extrabold text-amber-600 dark:text-amber-400">Featured Gold Partners</h2>
      </div>
      <a href="#featured" class="text-xs px-3 py-1 rounded bg-amber-100 text-amber-800 hover:bg-amber-200 transition">Jump</a>
    </div>
    <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">Top-tier visibility. Premium placement. Maximum reach.</p>
  
    <!-- Swiper Gold Carousel -->
    <div class="swiper goldSwiper rounded-2xl overflow-hidden shadow-lg">
      <div class="swiper-wrapper" id="gold-swiper-wrapper">
        <div class="swiper-slide flex flex-col items-center justify-center text-gray-500 py-10">
          Loading featured gold listings…
        </div>
      </div>
      <div class="swiper-pagination mt-4"></div>
    </div>
  </section>

  <!-- ========== Popular Categories + Silver/Bronze + Map ========== -->
  <main class="container mx-auto max-w-7xl px-6 -mt-8">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 equal-grid">

      <!-- Left: Popular Categories (full, sticky) -->
      <section id="popular-categories" class="lg:col-span-3 bg-white dark:bg-gray-800 rounded-2xl shadow micro flex flex-col" data-aos="fade-up">
        <div class="p-4 sticky-title bg-white/80 dark:bg-gray-800/60 rounded-t-2xl">
          <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Popular Categories</h3>
          <p class="text-xs text-gray-500 dark:text-gray-300">Top & trending — tap to filter listings.</p>
        </div>
        <div id="categories-list" class="flex-1 overflow-y-auto p-4 pt-2 space-y-3 max-h-[68vh]">
          <!-- Loading placeholders -->
          <div class="skeleton h-10 w-full"></div>
          <div class="skeleton h-10 w-full"></div>
          <div class="skeleton h-10 w-full"></div>
        </div>
        <div class="p-4 border-t border-gray-100 dark:border-gray-700 rounded-b-2xl">
          <button id="more-categories" class="w-full py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-sm hover:bg-indigo-50 dark:hover:bg-gray-700 transition">Show more</button>
        </div>
      </section>

      <!-- Middle: Silver & Bronze listings (priority before map) -->
       


      <section class="lg:col-span-6 space-y-6 flex flex-col" id="priority-listings">
        

        <!-- Silver & Bronze side-by-side -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" data-aos="fade-up">
          <section class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow flex flex-col">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-gray-400">🥈</span>
              <h4 class="font-extrabold text-gray-700 dark:text-gray-300">Silver Listings</h4>
            </div>
            <div id="tier-silver" class="grid grid-cols-1 gap-4 overflow-y-auto max-h-[52vh] pr-1">
              <div class="skeleton h-24 rounded-xl"></div>
              <div class="skeleton h-24 rounded-xl"></div>
            </div>
            <div class="mt-4">
              <button id="more-silver" class="w-full py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-sm">More Silver</button>
            </div>
          </section>

          <section class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow flex flex-col">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-orange-500">🥉</span>
              <h4 class="font-extrabold text-orange-600 dark:text-orange-400">Bronze Listings</h4>
            </div>
            <div id="tier-bronze" class="grid grid-cols-1 gap-4 overflow-y-auto max-h-[52vh] pr-1"></div>
            <div class="mt-4">
              <button id="more-bronze" class="w-full py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-sm">More Bronze</button>
            </div>
          </section>
        </div>

        <!-- Unified Listings grid (distance / region filter ready) -->
        <section class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow micro mt-8" data-aos="fade-up">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-semibold">All Listings</h4>
              <div class="flex items-center gap-2">
                <select id="region-filter" class="rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 text-sm">
                  <option value="">All Regions</option>
                </select>
                <select id="category-filter" class="rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 text-sm">
                  <option value="">All Categories</option>
                </select>
              </div>
            </div>
            <div id="listings-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="text-sm text-gray-500">Loading listings…</div>
            </div>
            <div class="mt-4 text-center">
              <a id="view-more" href="listings.html" class="inline-flex items-center gap-2 px-5 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition">View All Listings</a>
            </div>
          </section>
      </section>

      <!-- Right: Map (same height column) -->
      <aside class="lg:col-span-3 bg-white dark:bg-gray-800 rounded-2xl p-4 shadow micro flex flex-col" data-aos="fade-up">
        <div class="flex items-center justify-between">
          <h4 class="font-semibold">Coastal Map</h4>
          <button id="recenter" class="text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-700">Recenter</button>
        </div>
        <div id="map" class="w-full rounded-lg overflow-hidden mt-2" style="height: 68vh"></div>
        <p class="text-xs text-gray-500 mt-2">Click a pin to filter regional listings.</p>
      </aside>

    </div>
  </main>

  <!-- ========== Impact / Testimonials / CTA ========== -->
  <section class="container mx-auto max-w-7xl px-6 py-16">
    <div class="bg-gradient-to-r from-indigo-50 to-white dark:from-gray-800 dark:to-gray-900 rounded-2xl p-8" data-aos="fade-up">
      <h3 class="text-2xl font-extrabold mb-6">Real Impact on the Coast</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <blockquote class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow micro">
          <p class="text-gray-700 dark:text-gray-200">“Coast Connect brought my guest house bookings back to life. Simple to use and local customers respond fast.”</p>
          <footer class="mt-3 text-sm text-gray-500">— Amina, Guest House Owner (Kilifi)</footer>
        </blockquote>
        <blockquote class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow micro">
          <p class="text-gray-700 dark:text-gray-200">“Our craft shop started shipping beyond the county thanks to the platform’s visibility.”</p>
          <footer class="mt-3 text-sm text-gray-500">— Hassan, Arts & Crafts (Lamu)</footer>
        </blockquote>
        <blockquote class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow micro">
          <p class="text-gray-700 dark:text-gray-200">“The map and categories make it easy for tourists to find tours and services.”</p>
          <footer class="mt-3 text-sm text-gray-500">— Fatuma, Tour Operator (Mombasa)</footer>
        </blockquote>
      </div>
      <div class="mt-8 text-center">
        <a href="listings.html" class="px-8 py-3 rounded-full bg-gradient-to-r from-indigo-600 to-indigo-500 text-white font-semibold shadow-lg">List Your Business Now</a>
      </div>
    </div>
  </section>

  <!-- CTA Banner -->
  <section class="py-12 px-6">
    <div class="container mx-auto max-w-7xl">
      <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-8 text-center shadow-lg" data-aos="zoom-in">
        <h2 class="text-2xl font-extrabold text-black mb-2">Grow local revenue — list today</h2>
        <p class="text-black/80 mb-4">Create your free listing and connect with customers across the coast — mobile-friendly, fast, trusted.</p>
        <a href="listings.html" class="inline-block bg-black text-white px-6 py-3 rounded-full font-semibold shadow hover:scale-105 transition">🚀 Start Now</a>
      </div>
    </div>
  </section>

  <!-- ========== Footer ========== -->
  <footer class="bg-gray-900 text-gray-300 py-10">
    <div class="container mx-auto max-w-7xl px-6 grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
        <img src="images/coast_logo.png" alt="Coast Connect" class="w-24 mb-3">
        <p class="text-sm">Your local marketplace — connect, grow, thrive on the Coast.</p>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Quick Links</h4>
        <ul class="text-sm space-y-1">
          <li><a href="index.html" class="hover:text-white">Home</a></li>
          <li><a href="listings.html" class="hover:text-white">Listings</a></li>
          <li><a href="categories.html" class="hover:text-white">Categories</a></li>
          <li><a href="contact.html" class="hover:text-white">Contact</a></li>
        </ul>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Contact</h4>
        <p class="text-sm">Email: jumalesly01@gmail.com</p>
        <p class="text-sm">Mombasa, Kenya</p>
      </div>
    </div>

    <div class="mt-8 text-center text-xs text-gray-500">
      © <span id="year"></span> Coast Connect · Built for the Coast.
    </div>
  </footer>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 hidden z-[60]">
    <div class="glass dark:glass-dark px-4 py-2 rounded-xl shadow text-sm"></div>
  </div>

  <!-- ========== External Scripts ========== -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- ========== App Script ========== -->
  <script>
    // ---------- Utilities ----------
    const el = (sel) => document.querySelector(sel);
    const els = (sel) => Array.from(document.querySelectorAll(sel));
    const formatK = (n) => n >= 1000 ? (n/1000).toFixed(1) + 'k' : ''+n;

    const showToast = (msg, ms=2200) => {
      const t = el('#toast');
      if (!t) return; const box = t.firstElementChild; box.textContent = msg; t.classList.remove('hidden');
      gsap.fromTo(t, { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: .35, ease: 'power3.out' });
      setTimeout(()=> gsap.to(t, { opacity: 0, y: 20, duration: .35, onComplete: ()=>{ t.classList.add('hidden'); t.style.opacity = 1; } }), ms);
    };

    // ---------- Dark mode ----------
    (function setupDark(){
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const stored = localStorage.getItem('cc-dark');
      const isDark = stored === null ? prefersDark : stored === 'true';
      if (isDark) document.documentElement.classList.add('dark');
      const icon = el('#dark-icon');
      function updateIcon(){
        if (document.documentElement.classList.contains('dark')) {
          icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
        } else {
          icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-10h-1M4.34 12h-1M18.36 6.36l-.7.7M6.34 18.36l-.7.7M18.36 17.64l-.7-.7M6.34 5.64l-.7-.7M12 6a6 6 0 000 12 6 6 0 000-12z"/>';
        }
      }
      updateIcon();
      el('#dark-toggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('cc-dark', document.documentElement.classList.contains('dark'));
        updateIcon();
      });
    })();

    // ---------- AOS init ----------
    AOS.init({ once: true, duration: 850, easing: 'ease-in-out' });

    // ---------- Loader hide ----------
    window.addEventListener('load', () => {
      gsap.to('#loader', { opacity: 0, duration: .45, onComplete: () => el('#loader')?.remove() });
    });

    // ---------- Typewriter & rotating hero category pills ----------
    const phrases = [
      "Connect. Serve. Uplift the Coast.",
      "Empower Locals. Inspire Change.",
      "From Lamu to Diani — We Unite.",
      "Welcome to Coast Connect.",
      "Bridge. Build. Believe."
    ];
    let pIndex = 0;
    const typeEl = el('#typewriter-text');
    function showPhrase(){
      const txt = phrases[pIndex++];
      typeEl.textContent = '';
      let i = 0; const speed = 28 + Math.floor(Math.random()*6);
      const t = setInterval(()=> {
        if (i <= txt.length) { typeEl.textContent = txt.slice(0,i); i++; } else { clearInterval(t); }
      }, speed);
      if (pIndex >= phrases.length) pIndex = 0;
    }
    showPhrase();
    setInterval(showPhrase, 4500);

    // ---------- Mobile toggle ----------
    el('#mobile-toggle').addEventListener('click', () => {
      el('#mobile-panel').classList.toggle('hidden');
    });

    // ---------- Load categories.json & listings.json ----------
    let CATEGORIES = [];
    let LISTINGS = [];

    async function loadData(){
      try {
        const [catRes, listRes] = await Promise.all([
          fetch('categories.json'),
          fetch('legendary_listings.json')
        ]);
        if (!catRes.ok || !listRes.ok) throw new Error('JSON fetch failed');
        const catData = await catRes.json();
        const listData = await listRes.json();

        CATEGORIES = Array.isArray(catData.categories) ? catData.categories : (catData || []);
        LISTINGS = Array.isArray(listData.listings) ? listData.listings : (listData || []);

        // soft normalize
        LISTINGS = LISTINGS.map((l,i)=> ({
          id: l.id ?? i+1,
          title: l.title ?? 'Untitled',
          image: l.image ?? 'images/listings/placeholder.webp',
          region: l.region ?? '',
          category: l.category ?? '',
          categoryId: l.categoryId ?? '',
          subcategory: l.subcategory ?? '',
          excerpt: l.excerpt ?? '',
          url: l.url ?? 'listing_detail.html',
          reviews: l.reviews ?? 0,
          featured: !!l.featured,
          tier: (l.tier || '').toLowerCase(), // gold | silver | bronze | ''
          lat: l.lat ?? null,
          lng: l.lng ?? null,
        }));
      } catch (err) {
        console.error('Failed to load JSON:', err);
        showToast('Could not load data. Using empty state.');
        CATEGORIES = CATEGORIES.length ? CATEGORIES : [];
        LISTINGS = LISTINGS.length ? LISTINGS : [];
      }
    }

    // ---------- Marquee ----------
    function renderMarquee(){
      const bar = el('#cat-marquee');
      if (!bar) return;
      bar.innerHTML = '';
      const items = CATEGORIES.slice(0,18).map(c=> c.title || c.name || c.id);
      if (!items.length) return;
      const loop = [...items, ...items];
      loop.forEach((t)=>{
        const pill = document.createElement('span');
        pill.className = 'px-3 py-1 rounded-full bg-white/10 border border-white/20 backdrop-blur text-sm';
        pill.textContent = t;
        bar.appendChild(pill);
      });
      const totalWidth = bar.scrollWidth;
      gsap.to(bar, { x: () => -(totalWidth/2), ease: 'none', duration: 18, repeat: -1 });
    }

    // ---------- Hero Rotator ----------
    let rotatorIdx = 0, rotatorTimer = null;
    function renderHeroRotator(){
      const box = el('#hero-rotator');
      if (!box) return;
      box.innerHTML = '';
      const pick = (CATEGORIES || []).slice(0, 8);
      pick.forEach((cat, i) => {
        const btn = document.createElement('button');
        btn.className = 'w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 hover:bg-indigo-50 dark:hover:bg-gray-700 micro';
        btn.innerHTML = `
          <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
          <div>
            <div class="font-semibold text-sm">${cat.title || cat.name || 'Category'}</div>
            <div class="text-xs text-gray-500 dark:text-gray-300">${cat.description ? cat.description.slice(0,60) : ''}</div>
          </div>`;
        btn.addEventListener('click', () => applyFilter({ category: cat.id || cat.title || cat.name }));
        box.appendChild(btn);
      });

      // rotation animation
      function cycle(){
        const items = Array.from(box.children);
        if (!items.length) return;
        const first = items[0];
        gsap.to(first, { height: 0, opacity: 0, margin: 0, duration: .35, ease: 'power2.in', onComplete: ()=>{
          first.remove();
          const nextCat = CATEGORIES[(rotatorIdx++) % CATEGORIES.length] || {};
          const btn = document.createElement('button');
          btn.className = 'w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 hover:bg-indigo-50 dark:hover:bg-gray-700 micro';
          btn.innerHTML = `
            <img src="${nextCat.image || 'images/categories/placeholder.webp'}" alt="${nextCat.title || 'Category'}" class="w-10 h-10 rounded-lg object-cover"/>
            <div>
              <div class="font-semibold text-sm">${nextCat.title || nextCat.name || 'Category'}</div>
              <div class="text-xs text-gray-500 dark:text-gray-300">${nextCat.description ? nextCat.description.slice(0,60) : ''}</div>
            </div>`;
          btn.addEventListener('click', () => applyFilter({ category: nextCat.id || nextCat.title || nextCat.name }));
          btn.style.height = '0px'; btn.style.opacity = '0';
          box.appendChild(btn);
          gsap.to(btn, { height: '48px', opacity: 1, duration: .35, ease: 'power2.out' });
        }});
      }
      rotatorTimer && clearInterval(rotatorTimer);
      rotatorTimer = setInterval(cycle, 2200);
      el('#start-rotator')?.addEventListener('click', ()=>{ cycle(); });
    }

    // ---------- Popular Categories list ----------
    function renderCategoriesList(){
      const container = el('#categories-list');
      container.innerHTML = '';
      if (!CATEGORIES.length) {
        container.innerHTML = '<div class="text-sm text-gray-500">No categories found.</div>';
        return;
      }
      const MAX = 40; // initial
      (CATEGORIES.slice(0,MAX)).forEach(cat => {
        const li = document.createElement('div');
        li.className = 'flex items-start gap-3 p-2 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-700 cursor-pointer micro';
        li.innerHTML = `
          <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
          <div class="flex-1">
            <div class="flex items-center justify-between">
              <div class="font-semibold text-sm">${cat.title || cat.name}</div>
              <div class="text-xs text-gray-400">${cat.subcategories ? cat.subcategories.length : 0}</div>
            </div>
            <div class="text-xs text-gray-500 mt-1">${cat.description ? cat.description.slice(0,80) : ''}</div>
            <div class="mt-2 flex flex-wrap gap-2">${(cat.subcategories || []).slice(0,6).map(s => `<span class='px-2 py-0.5 text-xs bg-indigo-50 dark:bg-gray-700 text-indigo-600 rounded-full'>${s.name}</span>`).join('')}</div>
          </div>`;
        li.addEventListener('click', () => applyFilter({ category: cat.id || cat.title || cat.name }));
        container.appendChild(li);
      });

      // show more
      el('#more-categories').onclick = () => {
        const remain = CATEGORIES.slice(container.children.length);
        remain.slice(0, 40).forEach(cat => {
          const li = document.createElement('div');
          li.className = 'flex items-start gap-3 p-2 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-700 cursor-pointer micro';
          li.innerHTML = `
            <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <div class="font-semibold text-sm">${cat.title || cat.name}</div>
                <div class="text-xs text-gray-400">${cat.subcategories ? cat.subcategories.length : 0}</div>
              </div>
              <div class="text-xs text-gray-500 mt-1">${cat.description ? cat.description.slice(0,80) : ''}</div>
            </div>`;
          li.addEventListener('click', () => applyFilter({ category: cat.id || cat.title || cat.name }));
          container.appendChild(li);
        });
        if (container.children.length >= CATEGORIES.length) el('#more-categories').setAttribute('disabled','true');
      }
    }

    // ---------- Card template ----------
    function cardHTML(item){
      const ribbon = item.tier === 'gold' ? 'ribbon ribbon-gold' : item.tier === 'silver' ? 'ribbon ribbon-silver' : item.tier === 'bronze' ? 'ribbon ribbon-bronze' : '';
      const ribbonText = item.tier ? item.tier.toUpperCase() : (item.featured ? 'FEATURED' : '');
      return `
        <article class="relative bg-white dark:bg-gray-800 rounded-xl shadow micro overflow-hidden">
          ${ ribbonText ? `<span class="${ribbon}">${ribbonText}</span>` : '' }
          <img loading="lazy" src="${item.image}" alt="${item.title}" class="w-full h-36 object-cover"/>
          <div class="p-4">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h5 class="font-bold text-sm">${item.title}</h5>
                <p class="text-xs text-gray-500 dark:text-gray-300">${item.category ? item.category : ''} ${item.subcategory ? ' > ' + item.subcategory : ''}</p>
              </div>
              <div class="text-xs text-gray-400">${item.region || ''}</div>
            </div>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">${item.excerpt || ''}</p>
            <div class="mt-3 flex items-center justify-between">
              <a href="${item.url}" class="text-sm text-white bg-indigo-600 px-3 py-1 rounded">View</a>
              <div class="text-xs text-gray-400">${item.reviews ? item.reviews + ' reviews' : ''}</div>
            </div>
          </div>
        </article>`;
    }

    // ---------- Legendary Gold Swiper with Staggered Animation ----------
    function renderFeatured() {
    const wrapper = el('#gold-swiper-wrapper');
    const featured = LISTINGS.filter(l => l.tier === 'gold' || l.featured);

    if (!featured.length) {
        wrapper.innerHTML = `<div class='swiper-slide flex items-center justify-center text-gray-500'>No featured listings yet.</div>`;
        return;
    }

    // Populate slides with animation wrapper
    wrapper.innerHTML = featured.map((item, index) => `
        <div class='swiper-slide p-2'>
        <div class='bg-white dark:bg-gray-800 rounded-2xl shadow micro overflow-hidden flex gap-4 relative transform scale-90 opacity-0 transition-transform transition-opacity duration-500 delay-${index*100}'>
            <span class='ribbon ribbon-gold'>GOLD</span>
            <img loading='lazy' src='${item.image || "images/listings/placeholder.webp"}' alt='${item.title}' class='w-32 h-24 md:w-40 md:h-32 object-cover rounded-l-xl'/>
            <div class='p-3 flex-1'>
            <h4 class='font-semibold text-sm md:text-base'>${item.title}</h4>
            <p class='text-xs text-gray-500 dark:text-gray-300 line-clamp-2'>${item.excerpt || ''}</p>
            <div class='mt-2 flex items-center justify-between'>
                <a href='${item.url || "listing_detail.html"}' class='text-xs md:text-sm bg-indigo-600 text-white px-2 py-1 rounded'>View</a>
                <div class='text-xs text-gray-400'>${item.region || ''}</div>
            </div>
            </div>
        </div>
        </div>
    `).join('');

    // Animate cards after DOM update
    setTimeout(() => {
        wrapper.querySelectorAll('.swiper-slide > div').forEach((el, i) => {
        setTimeout(() => {
            el.classList.remove('scale-90', 'opacity-0');
            el.classList.add('scale-100', 'opacity-100');
        }, i * 150);
        });
    }, 50);

    // Destroy previous Swiper if exists
    if (window.goldSwiper) goldSwiper.destroy(true, true);

    // Initialize Swiper
    window.goldSwiper = new Swiper('.goldSwiper', {
        slidesPerView: 5,
        spaceBetween: 16,
        loop: true,
        speed: 2500,
        autoplay: { delay: 0, disableOnInteraction: false }, // continuous
        freeMode: true,
        freeModeMomentum: false,
        breakpoints: {
        320: { slidesPerView: 1.2 },
        640: { slidesPerView: 2.2 },
        768: { slidesPerView: 3.2 },
        1024: { slidesPerView: 5 },
        }
    });
    }

    // Call this after LISTINGS data is loaded
    renderFeatured();


    // ---------- Tiers rendering (Silver, Bronze) ----------
    let visibleSilver = 8, visibleBronze = 8;
    function renderTiers(){
      const silver = LISTINGS.filter(l=> l.tier==='silver');
      const bronze = LISTINGS.filter(l=> l.tier==='bronze');

      const fill = (id, items, visible)=>{
        const box = el(id);
        if (!box) return;
        if (!items.length) { box.innerHTML = '<div class="text-sm text-gray-500">No partners yet.</div>'; return; }
        const subset = items.slice(0,visible);
        const html = subset.map(item => cardHTML(item)).join('');
        box.innerHTML = html;
        els(`${id} article`).forEach((node, i)=> {
          gsap.from(node, { y: 16, opacity: 0, duration: .45, delay: i*0.04, ease: 'power2.out' });
        });
      };

      fill('#tier-silver', silver, visibleSilver);
      fill('#tier-bronze', bronze, visibleBronze);

      el('#more-silver').onclick = ()=> { visibleSilver += 6; fill('#tier-silver', silver, visibleSilver); };
      el('#more-bronze').onclick = ()=> { visibleBronze += 6; fill('#tier-bronze', bronze, visibleBronze); };
    }

    // ---------- Unified listings grid ----------
    function renderListings(filtered = null){
      const container = el('#listings-grid');
      const arr = filtered || LISTINGS;
      if (!arr.length) { container.innerHTML = '<div class="text-center text-gray-500">No listings match your filters.</div>'; return; }
      const score = (l)=> (l.tier==='gold'?3:l.tier==='silver'?2:l.tier==='bronze'?1:0) + (l.featured?0.25:0);
      const sorted = [...arr].sort((a,b)=> score(b)-score(a));
      container.innerHTML = sorted.slice(0,24).map(cardHTML).join('');
    }

    // ---------- Map (Leaflet) ----------
    let map;
    const COUNTY_PINS = [
      { id: 'Mombasa', coords: [-4.0435, 39.6682], popup: 'Mombasa' },
      { id: 'Kilifi', coords: [-3.63, 39.8526], popup: 'Kilifi' },
      { id: 'Kwale', coords: [-4.18, 39.45], popup: 'Kwale' },
      { id: 'Lamu', coords: [-2.27, 40.90], popup: 'Lamu' },
      { id: 'Taita Taveta', coords: [-3.39, 38.32], popup: 'Taita Taveta' },
      { id: 'Tana River', coords: [-1.50, 40.00], popup: 'Tana River' }
    ];
    function initMap(){
      map = L.map('map', { scrollWheelZoom: false }).setView([-3.5, 39.8], 7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

      COUNTY_PINS.forEach(pin => {
        const marker = L.marker(pin.coords).addTo(map);
        marker.bindPopup(`<div class="text-sm font-semibold">${pin.popup}</div><div class="text-xs text-gray-500">Click to filter</div>`);
        marker.on('click', () => { applyFilter({ region: pin.id }); });
      });
    }

    // ---------- Filters & search ----------
    function applyFilter({ category=null, region=null, q=null } = {}){
      if (category) { const catSelect = el('#category-filter'); if (catSelect) catSelect.value = category; }
      if (region) { const regSelect = el('#region-filter'); if (regSelect) regSelect.value = region; }
      const c = (category || el('#category-filter').value || '').trim();
      const r = (region || el('#region-filter').value || '').trim();
      const qv = (q || el('#quick-search').value || '').trim().toLowerCase();

      const filtered = LISTINGS.filter(l => {
        let ok = true;
        if (c) { ok = ok && ((l.category && (l.category === c || l.category.toLowerCase() === c.toLowerCase())) || (l.categoryId && l.categoryId === c) || (l.subcategory && l.subcategory === c)); }
        if (r) ok = ok && (l.region && l.region.toLowerCase() === r.toLowerCase());
        if (qv) ok = ok && ((l.title && l.title.toLowerCase().includes(qv)) || (l.excerpt && l.excerpt.toLowerCase().includes(qv)) || (l.category && l.category.toLowerCase().includes(qv)));
        return ok;
      });

      renderListings(filtered);
      document.querySelector('#listings-grid')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function bindFilters(){
      el('#category-filter').addEventListener('change', () => applyFilter({}));
      el('#region-filter').addEventListener('change', () => applyFilter({}));
      el('#quick-search').addEventListener('input', () => {
        const qv = el('#quick-search').value.trim().toLowerCase();
        if (!qv) { renderHeroRotator(); renderFeatured(); renderListings(); return; }
        const matched = CATEGORIES.filter(c => ((c.title||'') + ' ' + (c.description||'')).toLowerCase().includes(qv));
        if (matched.length) {
          const container = el('#hero-rotator');
          container.innerHTML = matched.slice(0,10).map(cat => `
            <button class="w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 hover:bg-indigo-50 dark:hover:bg-gray-700 micro" data-cat="${cat.id || cat.title}">
              <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
              <div>
                <div class="font-semibold text-sm">${cat.title || cat.name}</div>
                <div class="text-xs text-gray-500 dark:text-gray-300">${cat.description ? cat.description.slice(0,60) : ''}</div>
              </div>
            </button>
          `).join('');
          container.querySelectorAll('button[data-cat]').forEach(b => { b.addEventListener('click', () => applyFilter({ category: b.dataset.cat })); });
        } else {
          applyFilter({ q: qv });
        }
      });

      el('#more-categories').addEventListener('click', () => {}); // handled inside render

      window.addEventListener('keydown', (e)=>{
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k') { e.preventDefault(); el('#quick-search').focus(); showToast('Search ready (⌘/Ctrl + K)'); }
      });
    }

    // ---------- Counters ----------
    function animateCounter(id, target, duration=1100){
      const elc = document.getElementById(id); if (!elc) return;
      let start = 0; const step = Math.max(1, Math.ceil(target / (duration / 22)));
      const t = setInterval(()=> { start += step; if (start >= target) { start = target; clearInterval(t); } elc.textContent = formatK(start); }, 22);
    }

    // ---------- Equal-Height Columns (on resize) ----------
    function equalizeColumns(){
      // The three main columns: Popular (left), Priority (middle), Map (right)
      const left = document.querySelector('#popular-categories');
      const mid = document.querySelector('#priority-listings');
      const right = document.querySelector('aside #map')?.parentElement?.parentElement;
      if (!left || !mid || !right) return;
      const maxH = Math.max(left.offsetHeight, mid.offsetHeight, right.offsetHeight);
      left.style.minHeight = right.style.minHeight = mid.style.minHeight = maxH + 'px';
    }

    // ---------- Boot ----------
    (async function init(){
      await loadData();

      if (!CATEGORIES.length) { CATEGORIES = window.CATEGORIES || []; }
      if (!LISTINGS.length) { LISTINGS = window.LISTINGS || []; }

      renderHeroRotator();
      renderCategoriesList();
      renderMarquee();
      renderFeatured();
      renderTiers();
      renderListings();

      // populate selects
      const catSelect = el('#category-filter');
      CATEGORIES.forEach(c => { const o = document.createElement('option'); o.value = c.title || c.id || c.name; o.textContent = c.title || c.name; catSelect.appendChild(o); });
      const regionSel = el('#region-filter');
      Array.from(new Set(LISTINGS.map(l => l.region).filter(Boolean))).forEach(r => { const o = document.createElement('option'); o.value = r; o.textContent = r; regionSel.appendChild(o); });

      // Map
      initMap();

      // Counters
      el('#year').textContent = new Date().getFullYear();
      const businessCount = LISTINGS.length || 0;
      const regionsCount = new Set(LISTINGS.map(l => l.region).filter(Boolean)).size || 6;
      const clientsCount = Math.max(1200, Math.round(businessCount*12));
      animateCounter('count-businesses', businessCount);
      animateCounter('count-regions', regionsCount);
      animateCounter('count-clients', clientsCount);

      // Equalize columns on load + resize
      setTimeout(equalizeColumns, 200);
      window.addEventListener('resize', () => { setTimeout(equalizeColumns, 120); });

      // subtle hero float
      gsap.to('.glass', { y: -2, duration: 2, repeat: -1, yoyo: true, ease: 'sine.inOut' });

      bindFilters();
    })();
  </script>

  <!-- ========== AOS refresh ========== -->
  <script>
    setTimeout(()=> AOS.refresh(), 900);
  </script>

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Coast Connect",
    "url": "https://example.com/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://example.com/listings.html?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
</body>
</html>
