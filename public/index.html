<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coast Connect — Home</title>
  <link rel="icon" href="images/coast_logo.png" />
  <!-- Tailwind (cdn) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />

  <!-- Swiper -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <meta name="description" content="Coast Connect — connecting coastal businesses and people along Kenya's coast" />

  <style>
    /* ---------- Custom UI touches ---------- */
    /* Glassmorphism */
    .glass {
      background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(255,255,255,0.18));
      backdrop-filter: blur(8px) saturate(120%);
      -webkit-backdrop-filter: blur(8px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.12);
    }
    /* Dark glass */
    .glass-dark {
      background: linear-gradient(135deg, rgba(17,24,39,0.6), rgba(17,24,39,0.18));
      border: 1px solid rgba(255,255,255,0.04);
    }

    /* Category pill */
    .pill {
      @apply inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium;
    }

    /* small helpers */
    .smooth-shadow { box-shadow: 0 8px 30px rgba(15,23,42,0.06); }
    .micro { transition: all .28s cubic-bezier(.2,.9,.2,1); }
    .micro:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 18px 40px rgba(15,23,42,0.08); }

    /* hero right quick categories */
    .quick-cat::-webkit-scrollbar { width: 8px; }
    .quick-cat::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 999px; }

    /* dark mode overrides in tailwind classes are handled through the 'dark' class on <html> */
  </style>
</head>

<body class="bg-gray-50 text-gray-900 selection:bg-indigo-300 selection:text-white dark:bg-gray-900 dark:text-gray-100">
  <!-- ========== Header ========== -->
  <header class="sticky top-0 z-50">
    <nav class="backdrop-blur-md glass dark:glass-dark container mx-auto px-6 py-3 rounded-b-2xl flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <a href="index.html" class="flex items-center gap-3">
          <img src="images/coast_logo.png" alt="Coast Connect" class="w-10 h-10 rounded" />
          <div>
            <span class="font-extrabold text-lg text-indigo-600 dark:text-indigo-400">Coast Connect</span>
            <div class="text-xs -mt-1 text-gray-500 dark:text-gray-300">Connect · Serve · Uplift</div>
          </div>
        </a>
      </div>

      <div class="hidden md:flex items-center gap-8">
        <ul class="flex gap-6 items-center text-sm font-medium">
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="index.html">Home</a></li>
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="listings.html">Listings</a></li>
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="categories.html">Categories</a></li>
          <li><a class="hover:text-indigo-600 dark:hover:text-indigo-400 transition" href="about.html">About</a></li>
        </ul>
        <div class="flex items-center gap-3">
          <button id="dark-toggle" aria-label="Toggle dark mode" class="p-2 rounded-full micro bg-white dark:bg-gray-800/60">
            <!-- icon replaced in JS -->
            <svg id="dark-icon" class="w-5 h-5 text-indigo-600 dark:text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-10h-1M4.34 12h-1M18.36 6.36l-.7.7M6.34 18.36l-.7.7M18.36 17.64l-.7-.7M6.34 5.64l-.7-.7M12 6a6 6 0 000 12 6 6 0 000-12z"/></svg>
          </button>
          <a href="listings.html" class="inline-flex items-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-black px-4 py-2 rounded-lg font-semibold shadow">🚀 List Your Service</a>
        </div>
      </div>

      <!-- Mobile -->
      <div class="md:hidden flex items-center gap-3">
        <button id="mobile-toggle" class="p-2 rounded-md glass micro" aria-label="Open menu">
          <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </nav>

    <!-- Mobile menu panel -->
    <div id="mobile-panel" class="hidden md:hidden container mx-auto px-6 mt-3">
      <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow micro">
        <ul class="space-y-2">
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="index.html">Home</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="listings.html">Listings</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="categories.html">Categories</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="about.html">About</a></li>
          <li><a class="block py-2 px-3 rounded hover:bg-indigo-50 dark:hover:bg-gray-700" href="contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- ========== HERO (split) ========== -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 bg-[url('images/hero_sunset.jpg')] bg-cover bg-center brightness-75"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-white/10 mix-blend-multiply"></div>

    <div class="container mx-auto max-w-7xl relative z-20 py-20 px-6">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
        <!-- Left: Headline / Stats -->
        <div class="lg:col-span-7 text-center lg:text-left">
          <div class="max-w-2xl">
            <img src="images/coast_logo.png" alt="Coast Connect" class="w-20 h-20 mx-auto lg:mx-0 mb-4 drop-shadow-xl rounded-full" />
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white leading-tight" data-aos="fade-right">
              <span id="typewriter-text" class="inline-block"></span>
            </h1>
            <p class="mt-4 text-lg text-gray-200 max-w-xl" data-aos="fade-right" data-aos-delay="120">
              From Watamu to Lamu — discover businesses, services and community across the Coast. Fast, local, trusted.
            </p>

            <div class="mt-6 flex flex-col sm:flex-row gap-3 items-center" data-aos="fade-up" data-aos-delay="220">
              <a href="listings.html" class="inline-flex items-center gap-3 bg-yellow-400 hover:bg-yellow-500 text-black px-5 py-3 rounded-full font-semibold shadow-lg transform hover:scale-105 transition">List Your Service</a>
              <a href="#categories" class="inline-flex items-center gap-2 border border-white/30 text-white px-4 py-3 rounded-full hover:bg-white/5 transition">Explore Categories</a>
            </div>

            <!-- Animated Counters -->
            <div class="mt-8 grid grid-cols-3 gap-4 max-w-md" data-aos="fade-up" data-aos-delay="320">
              <div class="bg-white/10 glass-dark rounded-xl py-4 px-4 text-center">
                <div class="text-2xl font-extrabold text-white" id="count-businesses">0</div>
                <div class="text-xs text-gray-200">Businesses Listed</div>
              </div>
              <div class="bg-white/10 glass-dark rounded-xl py-4 px-4 text-center">
                <div class="text-2xl font-extrabold text-white" id="count-regions">0</div>
                <div class="text-xs text-gray-200">Regions Covered</div>
              </div>
              <div class="bg-white/10 glass-dark rounded-xl py-4 px-4 text-center">
                <div class="text-2xl font-extrabold text-white" id="count-clients">0</div>
                <div class="text-xs text-gray-200">Happy Clients</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Quick Categories (glass panel) -->
        <aside class="lg:col-span-5">
          <div class="glass rounded-2xl p-4 sm:p-6 max-h-[520px] overflow-y-auto quick-cat" data-aos="fade-left">
            <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3">Quick Categories</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">Tap a category to filter listings instantly.</p>

            <div id="quick-categories" class="space-y-3">
              <!-- js will inject pill items -->
            </div>

            <div class="mt-6">
              <input id="quick-search" type="search" placeholder="Search categories or listings..." class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-500" />
            </div>

            <div class="mt-6 text-center">
              <a href="categories.html" class="text-sm text-indigo-600 font-semibold hover:underline">View all categories</a>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <!-- ========== Regions + Featured Listings + Map ========== -->
  <main class="container mx-auto max-w-7xl px-6 -mt-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Left column: categories grid (collapsible on mobile) -->
      <section id="categories" class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-2xl p-4 shadow micro" data-aos="fade-up">
        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100 mb-3">Categories</h3>
        <div id="categories-list" class="flex flex-col gap-3 max-h-[64vh] overflow-y-auto py-1">
          <!-- dynamically injected -->
          <div class="text-sm text-gray-500">Loading categories…</div>
        </div>
        <div class="mt-4">
          <button id="clear-filters" class="w-full py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-sm">Clear filters</button>
        </div>
      </section>

      <!-- Middle column: Featured Swiper -->
      <section class="lg:col-span-2 space-y-6">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow micro" data-aos="fade-up">
          <div class="flex items-center justify-between">
            <h3 class="font-bold text-lg dark:text-gray-100">Featured Listings</h3>
            <div class="text-sm text-gray-500">Selected by Coast Connect</div>
          </div>

          <!-- Swiper -->
          <div class="mt-4">
            <div class="swiper mySwiper">
              <div class="swiper-wrapper" id="swiper-wrapper">
                <!-- slides injected from listings.json -->
                <div class="swiper-slide flex items-center justify-center text-sm text-gray-500">Loading featured listings...</div>
              </div>
              <!-- controls -->
              <div class="swiper-pagination !mt-4"></div>
            </div>
          </div>
        </div>

        <!-- Listings grid + map row -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl p-4 shadow micro" data-aos="fade-up">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-semibold">Listings</h4>
              <div class="flex items-center gap-2">
                <select id="region-filter" class="rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 text-sm">
                  <option value="">All Regions</option>
                </select>
                <select id="category-filter" class="rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 text-sm">
                  <option value="">All Categories</option>
                </select>
              </div>
            </div>

            <div id="listings-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- listing cards injected -->
              <div class="text-sm text-gray-500">Loading listings…</div>
            </div>

            <div class="mt-4 text-center">
              <a id="view-more" href="listings.html" class="inline-flex items-center gap-2 px-5 py-2 rounded-lg bg-indigo-600 text-white">View All Listings</a>
            </div>
          </div>

          <aside class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow micro" data-aos="fade-up">
            <h4 class="font-semibold mb-2">Coastal Map</h4>
            <div id="map" class="w-full h-64 rounded-lg overflow-hidden"></div>
            <p class="text-xs text-gray-500 mt-2">Click a pin to view regional listings.</p>
          </aside>
        </div>
      </section>
    </div>
  </main>

  <!-- ========== Testimonials & CTA ========== -->
  <section class="container mx-auto max-w-7xl px-6 py-16">
    <div class="bg-gradient-to-r from-indigo-50 to-white dark:from-gray-800 dark:to-gray-900 rounded-2xl p-8" data-aos="fade-up">
      <h3 class="text-2xl font-extrabold mb-6">What Coastal Business Owners Say</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <blockquote class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow micro">
          <p class="text-gray-700 dark:text-gray-200">“Coast Connect brought my guest house bookings back to life. Simple to use and local customers respond fast.”</p>
          <footer class="mt-3 text-sm text-gray-500">— Amina, Guest House Owner (Kilifi)</footer>
        </blockquote>
        <blockquote class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow micro">
          <p class="text-gray-700 dark:text-gray-200">“Our craft shop started shipping beyond the county thanks to the platform’s visibility.”</p>
          <footer class="mt-3 text-sm text-gray-500">— Hassan, Arts & Crafts (Lamu)</footer>
        </blockquote>
        <blockquote class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow micro">
          <p class="text-gray-700 dark:text-gray-200">“The map and categories make it easy for tourists to find tours and services.”</p>
          <footer class="mt-3 text-sm text-gray-500">— Fatuma, Tour Operator (Mombasa)</footer>
        </blockquote>
      </div>
      <div class="mt-8 text-center">
        <a href="listings.html" class="px-8 py-3 rounded-full bg-gradient-to-r from-indigo-600 to-indigo-500 text-white font-semibold shadow-lg">List Your Business Now</a>
      </div>
    </div>
  </section>

  <!-- CTA Banner -->
  <section class="py-12 px-6">
    <div class="container mx-auto max-w-7xl">
      <div class="bg-gradient-to-r from-yellow-400 to-orange-400 rounded-2xl p-8 text-center shadow-lg" data-aos="zoom-in">
        <h2 class="text-2xl font-extrabold text-black mb-2">Grow local revenue — list today</h2>
        <p class="text-black/80 mb-4">Create your free listing and connect with customers across the coast — mobile-friendly, fast, trusted.</p>
        <a href="listings.html" class="inline-block bg-black text-white px-6 py-3 rounded-full font-semibold shadow hover:scale-105 transition">🚀 Start Now</a>
      </div>
    </div>
  </section>

  <!-- ========== Footer ========== -->
  <footer class="bg-gray-900 text-gray-300 py-10">
    <div class="container mx-auto max-w-7xl px-6 grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
        <img src="images/coast_logo.png" alt="Coast Connect" class="w-24 mb-3">
        <p class="text-sm">Your local marketplace — connect, grow, thrive on the Coast.</p>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Quick Links</h4>
        <ul class="text-sm space-y-1">
          <li><a href="index.html" class="hover:text-white">Home</a></li>
          <li><a href="listings.html" class="hover:text-white">Listings</a></li>
          <li><a href="categories.html" class="hover:text-white">Categories</a></li>
          <li><a href="contact.html" class="hover:text-white">Contact</a></li>
        </ul>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Contact</h4>
        <p class="text-sm">Email: hello@coastconnect.example</p>
        <p class="text-sm">Mombasa, Kenya</p>
      </div>
    </div>

    <div class="mt-8 text-center text-xs text-gray-500">
      © <span id="year"></span> Coast Connect · Built for the Coast.
    </div>
  </footer>

  <!-- ========== External Scripts ========== -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- ========== App Script ========== -->
  <script>
    // ---------- Utilities ----------
    const el = (sel) => document.querySelector(sel);
    const els = (sel) => Array.from(document.querySelectorAll(sel));
    const formatK = (n) => n >= 1000 ? (n/1000).toFixed(1) + 'k' : ''+n;

    // ---------- Dark mode (auto + toggle) ----------
    (function setupDark(){
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const stored = localStorage.getItem('cc-dark');
      const isDark = stored === null ? prefersDark : stored === 'true';
      if (isDark) document.documentElement.classList.add('dark');
      const icon = el('#dark-icon');
      function updateIcon(){
        if (document.documentElement.classList.contains('dark')) {
          icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
        } else {
          icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-10h-1M4.34 12h-1M18.36 6.36l-.7.7M6.34 18.36l-.7.7M18.36 17.64l-.7-.7M6.34 5.64l-.7-.7M12 6a6 6 0 000 12 6 6 0 000-12z"/>';
        }
      }
      updateIcon();
      el('#dark-toggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('cc-dark', document.documentElement.classList.contains('dark'));
        updateIcon();
      });
    })();

    // ---------- AOS init ----------
    AOS.init({ once: true, duration: 850, easing: 'ease-in-out' });

    // ---------- Typewriter (phrases rotation) ----------
    const phrases = [
      "Connect. Serve. Uplift the Coast.",
      "Empower Locals. Inspire Change.",
      "From Lamu to Diani — We Unite.",
      "Welcome to Coast Connect.",
      "Bridge. Build. Believe."
    ];
    let pIndex = 0;
    const typeEl = el('#typewriter-text');
    function showPhrase(){
      const txt = phrases[pIndex++];
      typeEl.textContent = '';
      let i = 0;
      const t = setInterval(()=> {
        if (i <= txt.length) {
          typeEl.textContent = txt.slice(0,i);
          i++;
        } else { clearInterval(t); }
      }, 28);
      if (pIndex >= phrases.length) pIndex = 0;
    }
    showPhrase();
    setInterval(showPhrase, 4500);

    // ---------- Mobile toggle ----------
    el('#mobile-toggle').addEventListener('click', () => {
      el('#mobile-panel').classList.toggle('hidden');
    });

    // ---------- Load categories.json & listings.json ----------
    let CATEGORIES = [];
    let LISTINGS = [];

    async function loadData(){
      try {
        const [catRes, listRes] = await Promise.all([
          fetch('categories.json'),
          fetch('legendary_listings.json')
        ]);
        if (!catRes.ok || !listRes.ok) throw new Error('JSON fetch failed');
        const catData = await catRes.json();
        const listData = await listRes.json();

        CATEGORIES = Array.isArray(catData.categories) ? catData.categories : (catData || []);
        LISTINGS = Array.isArray(listData.listings) ? listData.listings : (listData || []);
      } catch (err) {
        console.error('Failed to load JSON:', err);
        // fallback to minimal sets (if you want, inject sample)
        CATEGORIES = CATEGORIES.length ? CATEGORIES : [];
        LISTINGS = LISTINGS.length ? LISTINGS : [];
      }
    }

    // ---------- Render quick categories (right hero) ----------
    function renderQuickCategories(){
      const container = el('#quick-categories');
      container.innerHTML = '';
      CATEGORIES.slice(0,12).forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 hover:bg-indigo-50 dark:hover:bg-gray-700 micro';
        btn.innerHTML = `
          <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
          <div>
            <div class="font-semibold text-sm">${cat.title}</div>
            <div class="text-xs text-gray-500 dark:text-gray-300">${cat.description ? cat.description.slice(0,60) : ''}</div>
          </div>
        `;
        btn.addEventListener('click', () => {
          applyFilter({ category: cat.id || cat.title });
          // scroll to listings
          window.scrollTo({ top: document.querySelector('#listings-grid').getBoundingClientRect().top + window.scrollY - 120, behavior: 'smooth' });
        });
        container.appendChild(btn);
      });
    }

    // ---------- Render categories sidebar list (left) ----------
    function renderCategoriesList(){
      const container = el('#categories-list');
      container.innerHTML = '';
      if (!CATEGORIES.length) {
        container.innerHTML = '<div class="text-sm text-gray-500">No categories found.</div>';
        return;
      }
      CATEGORIES.forEach(cat => {
        const li = document.createElement('div');
        li.className = 'flex items-start gap-3 p-2 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-700 cursor-pointer micro';
        li.innerHTML = `
          <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
          <div class="flex-1">
            <div class="flex items-center justify-between">
              <div class="font-semibold text-sm">${cat.title}</div>
              <div class="text-xs text-gray-400">${cat.subcategories ? cat.subcategories.length : 0}</div>
            </div>
            <div class="text-xs text-gray-500 mt-1">${cat.description ? cat.description.slice(0,80) : ''}</div>
            <div class="mt-2 flex flex-wrap gap-2">
              ${(cat.subcategories || []).slice(0,6).map(s => `<span class="px-2 py-0.5 text-xs bg-indigo-50 dark:bg-gray-700 text-indigo-600 rounded-full">${s.name}</span>`).join('')}
            </div>
          </div>
        `;
        li.addEventListener('click', () => {
          applyFilter({ category: cat.id || cat.title });
        });
        container.appendChild(li);
      });
    }

    // ---------- Fill region select based on listings regions ----------
    function populateRegionSelects(){
      const regions = new Set(LISTINGS.map(l => l.region).filter(Boolean));
      const regionFilter = el('#region-filter');
      const quickRegion = el('#region-filter'); // same for now
      regions.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        regionFilter.appendChild(opt);
      });
    }

    // ---------- Render listings grid ----------
    function renderListings(filtered = null){
      const container = el('#listings-grid');
      const arr = filtered || LISTINGS;
      if (!arr.length) {
        container.innerHTML = '<div class="text-center text-gray-500">No listings match your filters.</div>';
        return;
      }
      container.innerHTML = arr.slice(0,24).map(item => `
        <article class="bg-white dark:bg-gray-800 rounded-xl shadow micro overflow-hidden">
          <img loading="lazy" src="${item.image || 'images/listings/placeholder.webp'}" alt="${item.title}" class="w-full h-36 object-cover"/>
          <div class="p-4">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h5 class="font-bold text-sm">${item.title}</h5>
                <p class="text-xs text-gray-500 dark:text-gray-300">${item.category ? item.category : ''} ${item.subcategory ? ' > ' + item.subcategory : ''}</p>
              </div>
              <div class="text-xs text-gray-400">${item.region || ''}</div>
            </div>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">${item.excerpt || ''}</p>
            <div class="mt-3 flex items-center justify-between">
              <a href="${item.url || 'listing_detail.html'}" class="text-sm text-white bg-indigo-600 px-3 py-1 rounded">View</a>
              <div class="text-xs text-gray-400">${item.reviews ? item.reviews + ' reviews' : ''}</div>
            </div>
          </div>
        </article>
      `).join('');
    }

    // ---------- Featured listings (swiper) ----------
    let swiperInstance = null;
    function renderFeatured(){
      const wrapper = el('#swiper-wrapper');
      const featured = LISTINGS.filter(l => l.featured).slice(0,8);
      if (!featured.length) {
        wrapper.innerHTML = `<div class="swiper-slide flex items-center justify-center text-gray-500">No featured listings yet.</div>`;
      } else {
        wrapper.innerHTML = featured.map(item => `
          <div class="swiper-slide p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow micro overflow-hidden flex gap-4">
              <img loading="lazy" src="${item.image || 'images/listings/placeholder.webp'}" alt="${item.title}" class="w-40 h-32 object-cover rounded-l-xl"/>
              <div class="p-4 flex-1">
                <h4 class="font-semibold">${item.title}</h4>
                <p class="text-xs text-gray-500 dark:text-gray-300">${item.excerpt || ''}</p>
                <div class="mt-3 flex items-center justify-between">
                  <a href="${item.url || 'listing_detail.html'}" class="text-sm bg-indigo-600 text-white px-3 py-1 rounded">View</a>
                  <div class="text-xs text-gray-400">${item.region || ''}</div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }

      // init or re-init swiper
      setTimeout(()=> {
        if (swiperInstance) swiperInstance.destroy(true, true);
        swiperInstance = new Swiper('.mySwiper', {
          slidesPerView: 1,
          spaceBetween: 16,
          loop: true,
          autoplay: { delay: 4200, disableOnInteraction: false },
          pagination: { el: '.swiper-pagination', clickable: true },
          breakpoints: { 768: { slidesPerView: 1.3 }, 1024: { slidesPerView: 1.6 } }
        });
      }, 80);
    }

    // ---------- Map (Leaflet) ----------
    let map;
    const COUNTY_PINS = [
      { id: 'Mombasa', coords: [-4.0435, 39.6682], popup: 'Mombasa' },
      { id: 'Kilifi', coords: [-3.63, 39.8526], popup: 'Kilifi' },
      { id: 'Kwale', coords: [-4.18, 39.45], popup: 'Kwale' },
      { id: 'Lamu', coords: [-2.27, 40.90], popup: 'Lamu' },
      { id: 'Taita Taveta', coords: [-3.39, 38.32], popup: 'Taita Taveta' },
      { id: 'Tana River', coords: [-1.50, 40.00], popup: 'Tana River' }
    ];
    function initMap(){
      map = L.map('map', { scrollWheelZoom: false }).setView([-3.5, 39.8], 7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
      COUNTY_PINS.forEach(pin => {
        const marker = L.marker(pin.coords).addTo(map);
        marker.bindPopup(`<div class="text-sm font-semibold">${pin.popup}</div><div class="text-xs text-gray-500">Click to filter</div>`);
        marker.on('click', () => {
          applyFilter({ region: pin.id });
        });
      });
    }

    // ---------- Filters & search ----------
    function applyFilter({ category=null, region=null, q=null } = {}){
      // set selects UI
      if (category) {
        const catSelect = el('#category-filter');
        if (catSelect) catSelect.value = category;
      }
      if (region) {
        const regSelect = el('#region-filter');
        if (regSelect) regSelect.value = region;
      }
      // get global filters
      const c = (category || el('#category-filter').value || '').trim();
      const r = (region || el('#region-filter').value || '').trim();
      const qv = (q || el('#quick-search').value || el('#quick-search').value || el('#search-query')?.value || '').trim().toLowerCase();

      const filtered = LISTINGS.filter(l => {
        let ok = true;
        if (c) {
          ok = ok && ((l.category && (l.category === c || l.category.toLowerCase() === c.toLowerCase())) ||
                     (l.categoryId && l.categoryId === c) ||
                     (l.subcategory && l.subcategory === c));
        }
        if (r) ok = ok && (l.region && l.region.toLowerCase() === r.toLowerCase());
        if (qv) {
          ok = ok && (
            (l.title && l.title.toLowerCase().includes(qv)) ||
            (l.excerpt && l.excerpt.toLowerCase().includes(qv)) ||
            (l.category && l.category.toLowerCase().includes(qv))
          );
        }
        return ok;
      });

      renderListings(filtered);
      // scroll to results if they clicked category quickly
      if (document.querySelector('#listings-grid')) {
        document.querySelector('#listings-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // event binds for dropdowns and search
    function bindFilters(){
      el('#category-filter').addEventListener('change', () => applyFilter({}));
      el('#region-filter').addEventListener('change', () => applyFilter({}));
      el('#quick-search').addEventListener('input', () => {
        // simple category search: also find categories matching query
        const qv = el('#quick-search').value.trim().toLowerCase();
        if (!qv) {
          renderQuickCategories();
          renderFeatured();
          renderListings();
          return;
        }
        const matched = CATEGORIES.filter(c => (c.title + ' ' + (c.description||'')).toLowerCase().includes(qv));
        if (matched.length) {
          // show top 6 matched in quick panel
          const container = el('#quick-categories');
          container.innerHTML = matched.slice(0,10).map(cat => `
            <button class="w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 hover:bg-indigo-50 dark:hover:bg-gray-700 micro" data-cat="${cat.id || cat.title}">
              <img src="${cat.image || 'images/categories/placeholder.webp'}" alt="${cat.title}" class="w-10 h-10 rounded-lg object-cover"/>
              <div>
                <div class="font-semibold text-sm">${cat.title}</div>
                <div class="text-xs text-gray-500 dark:text-gray-300">${cat.description ? cat.description.slice(0,60) : ''}</div>
              </div>
            </button>
          `).join('');
          // add click delegation
          container.querySelectorAll('button[data-cat]').forEach(b => {
            b.addEventListener('click', () => applyFilter({ category: b.dataset.cat }));
          });
        } else {
          applyFilter({ q: qv });
        }
      });

      // clear filters
      el('#clear-filters').addEventListener('click', () => {
        el('#category-filter').value = '';
        el('#region-filter').value = '';
        el('#quick-search').value = '';
        renderQuickCategories();
        renderListings();
        renderFeatured();
      });

      // region filter in top search form (if exists)
      const regionFilter = el('#region');
      if (regionFilter) {
        // not used in this build but keep compatibility
        regionFilter.addEventListener('change', () => applyFilter({ region: regionFilter.value }));
      }
    }

    // ---------- Counters animation ----------
    function animateCounter(id, target, duration=1100){
      const elc = document.getElementById(id);
      if (!elc) return;
      let start = 0;
      const step = Math.ceil(target / (duration / 20));
      const t = setInterval(()=> {
        start += step;
        if (start >= target) {
          start = target;
          clearInterval(t);
        }
        elc.textContent = formatK(start);
      }, 20);
    }

    // ---------- Boot sequence ----------
    (async function init(){
      // load data
      await loadData();

      // Provide some graceful defaults if JSON not structured as expected
      if (!CATEGORIES.length) {
        // you told me you have categories.json — but in case it's nested differently:
        // attempt to read window.CATEGORIES injected or fallback to sample
        CATEGORIES = window.CATEGORIES || [];
      }
      if (!LISTINGS.length) {
        LISTINGS = window.LISTINGS || [];
      }

      // Render UI pieces
      renderQuickCategories();
      renderCategoriesList();
      populateRegionSelects();
      renderFeatured();
      renderListings();

      // init map
      initMap();

      // bindings
      bindFilters();

      // set year
      el('#year').textContent = new Date().getFullYear();

      // animate counters from listings length and regions count
      const businessCount = LISTINGS.length || 0;
      const regionsCount = new Set(LISTINGS.map(l => l.region).filter(Boolean)).size || 6;
      const clientsCount = Math.max(1200, Math.round(businessCount*12)); // example alg
      animateCounter('count-businesses', businessCount);
      animateCounter('count-regions', regionsCount);
      animateCounter('count-clients', clientsCount);

      // fill select options for categories (top)
      const catSelect = el('#category-filter');
      if (catSelect && CATEGORIES.length) {
        CATEGORIES.forEach(c => {
          const o = document.createElement('option');
          o.value = c.title || c.id;
          o.textContent = c.title;
          catSelect.appendChild(o);
        });
      }

      // quick-populate #region-filter
      const regionSet = new Set(LISTINGS.map(l => l.region).filter(Boolean));
      const regionSel = el('#region-filter');
      if (regionSel && regionSet.size) {
        regionSet.forEach(r => {
          const o = document.createElement('option');
          o.value = r;
          o.textContent = r;
          regionSel.appendChild(o);
        });
      }

      // wire quick category buttons (delegated)
      document.querySelectorAll('#quick-categories button').forEach(b => {
        b.addEventListener('click', () => {
          const title = b.querySelector('.font-semibold')?.textContent;
          if (title) applyFilter({ category: title });
        });
      });

      // if no JSON available, show helpful console message
      if (!CATEGORIES.length || !LISTINGS.length) {
        console.warn('Categories or Listings are empty — ensure categories.json and listings.json exist and contain arrays named "categories" and "listings".');
      }
    })();
  </script>

  <!-- ========== AOS & extras ========== -->
  <script>
    // initialize any AOS changes after dynamic content gets injected
    setTimeout(()=> AOS.refresh(), 900);
  </script>

</body>
</html>
